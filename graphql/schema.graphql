scalar Time

type Category {
  id: String!
  name: String!
  description: String!
}

type LikelihoodLevel {
  id: String!
  name: String!
  description: String!
  score: Int!
}

type ImpactLevel {
  id: String!
  name: String!
  description: String!
  score: Int!
}

type Team {
  id: String!
  name: String!
}

type SlackUser {
  id: String!
  name: String!
  realName: String!
  imageUrl: String
}

type RiskConfiguration {
  categories: [Category!]!
  likelihoodLevels: [LikelihoodLevel!]!
  impactLevels: [ImpactLevel!]!
  teams: [Team!]!
}

enum ResponseStatus {
  BACKLOG
  TODO
  IN_PROGRESS
  BLOCKED
  COMPLETED
  ABANDONED
}

type Response {
  id: Int!
  title: String!
  description: String!
  responderIDs: [String!]!
  responders: [SlackUser!]!
  url: String
  status: ResponseStatus!
  risks: [Risk!]!
  createdAt: Time!
  updatedAt: Time!
}

type Risk {
  id: Int!
  name: String!
  description: String!
  categoryIDs: [String!]!
  categories: [Category!]!
  specificImpact: String!
  likelihoodID: String!
  likelihoodLevel: LikelihoodLevel
  impactID: String!
  impactLevel: ImpactLevel
  responseTeamIDs: [String!]!
  responseTeams: [Team!]!
  assigneeIDs: [String!]!
  assignees: [SlackUser!]!
  detectionIndicators: String!
  slackChannelID: String
  responses: [Response!]!
  knowledges: [Knowledge!]!
  createdAt: Time!
  updatedAt: Time!
}

type Knowledge {
  id: String!
  riskID: Int!
  risk: Risk
  sourceID: String!
  sourceURL: String!
  title: String!
  summary: String!
  sourcedAt: Time!
  createdAt: Time!
  updatedAt: Time!
}

type KnowledgeConnection {
  items: [Knowledge!]!
  totalCount: Int!
  hasMore: Boolean!
}

input CreateRiskInput {
  name: String!
  description: String!
  categoryIDs: [String!]!
  specificImpact: String!
  likelihoodID: String!
  impactID: String!
  responseTeamIDs: [String!]!
  assigneeIDs: [String!]!
  detectionIndicators: String!
}

input UpdateRiskInput {
  id: Int!
  name: String!
  description: String!
  categoryIDs: [String!]!
  specificImpact: String!
  likelihoodID: String!
  impactID: String!
  responseTeamIDs: [String!]!
  assigneeIDs: [String!]!
  detectionIndicators: String!
}

input CreateResponseInput {
  title: String!
  description: String!
  responderIDs: [String!]!
  url: String
  status: ResponseStatus
  riskIDs: [Int!]
}

input UpdateResponseInput {
  id: Int!
  title: String
  description: String
  responderIDs: [String!]
  url: String
  status: ResponseStatus
  riskIDs: [Int!]
}

# Source types
enum SourceType {
  NOTION_DB
  SLACK
}

type Source {
  id: String!
  name: String!
  sourceType: SourceType!
  description: String!
  enabled: Boolean!
  config: SourceConfig!
  createdAt: Time!
  updatedAt: Time!
}

union SourceConfig = NotionDBConfig | SlackConfig

type NotionDBConfig {
  databaseID: String!
  databaseTitle: String!
  databaseURL: String!
}

type SlackConfig {
  channels: [SlackChannel!]!
}

type SlackChannel {
  id: String!
  name: String!
}

input CreateNotionDBSourceInput {
  name: String
  description: String
  databaseID: String!
  enabled: Boolean
}

input UpdateSourceInput {
  id: String!
  name: String
  description: String
  enabled: Boolean
}

type NotionDBValidationResult {
  valid: Boolean!
  databaseTitle: String
  databaseURL: String
  errorMessage: String
}

input CreateSlackSourceInput {
  name: String
  description: String
  channelIDs: [String!]!
  enabled: Boolean
}

input UpdateSlackSourceInput {
  id: String!
  name: String
  description: String
  channelIDs: [String!]
  enabled: Boolean
}

type SlackChannelInfo {
  id: String!
  name: String!
}

type Query {
  health: String!
  risks: [Risk!]!
  risk(id: Int!): Risk
  riskConfiguration: RiskConfiguration!
  slackUsers: [SlackUser!]!
  responses: [Response!]!
  response(id: Int!): Response
  responsesByRisk(riskID: Int!): [Response!]!
  sources: [Source!]!
  source(id: String!): Source
  slackJoinedChannels: [SlackChannelInfo!]!
  knowledge(id: String!): Knowledge
  knowledges(limit: Int, offset: Int): KnowledgeConnection!
}

type Mutation {
  noop: Boolean
  createRisk(input: CreateRiskInput!): Risk!
  updateRisk(input: UpdateRiskInput!): Risk!
  deleteRisk(id: Int!): Boolean!
  createResponse(input: CreateResponseInput!): Response!
  updateResponse(input: UpdateResponseInput!): Response!
  deleteResponse(id: Int!): Boolean!
  linkResponseToRisk(responseID: Int!, riskID: Int!): Boolean!
  unlinkResponseFromRisk(responseID: Int!, riskID: Int!): Boolean!
  createNotionDBSource(input: CreateNotionDBSourceInput!): Source!
  createSlackSource(input: CreateSlackSourceInput!): Source!
  updateSource(input: UpdateSourceInput!): Source!
  updateSlackSource(input: UpdateSlackSourceInput!): Source!
  deleteSource(id: String!): Boolean!
  validateNotionDB(databaseID: String!): NotionDBValidationResult!
}
