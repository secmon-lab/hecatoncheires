package graphql

// This file will be automatically regenerated based on the schema, any resolver
// implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.85

import (
	"context"

	"github.com/secmon-lab/hecatoncheires/pkg/domain/model"
	graphql1 "github.com/secmon-lab/hecatoncheires/pkg/domain/model/graphql"
)

// Noop is the resolver for the noop field.
func (r *mutationResolver) Noop(ctx context.Context) (*bool, error) {
	// TODO: Remove this dummy implementation when real mutations are added
	result := true
	return &result, nil
}

// CreateRisk is the resolver for the createRisk field.
func (r *mutationResolver) CreateRisk(ctx context.Context, input graphql1.CreateRiskInput) (*graphql1.Risk, error) {
	risk, err := r.uc.Risk.CreateRisk(ctx, input.Name, input.Description)
	if err != nil {
		return nil, err
	}

	return toGraphQLRisk(risk), nil
}

// UpdateRisk is the resolver for the updateRisk field.
func (r *mutationResolver) UpdateRisk(ctx context.Context, input graphql1.UpdateRiskInput) (*graphql1.Risk, error) {
	risk, err := r.uc.Risk.UpdateRisk(ctx, int64(input.ID), input.Name, input.Description)
	if err != nil {
		return nil, err
	}

	return toGraphQLRisk(risk), nil
}

// DeleteRisk is the resolver for the deleteRisk field.
func (r *mutationResolver) DeleteRisk(ctx context.Context, id int) (bool, error) {
	if err := r.uc.Risk.DeleteRisk(ctx, int64(id)); err != nil {
		return false, err
	}

	return true, nil
}

// Health is the resolver for the health field.
func (r *queryResolver) Health(ctx context.Context) (string, error) {
	// TODO: Remove this dummy implementation when real health check is added
	return "OK", nil
}

// Risks is the resolver for the risks field.
func (r *queryResolver) Risks(ctx context.Context) ([]*graphql1.Risk, error) {
	risks, err := r.uc.Risk.ListRisks(ctx)
	if err != nil {
		return nil, err
	}

	gqlRisks := make([]*graphql1.Risk, len(risks))
	for i, risk := range risks {
		gqlRisks[i] = toGraphQLRisk(risk)
	}

	return gqlRisks, nil
}

// Risk is the resolver for the risk field.
func (r *queryResolver) Risk(ctx context.Context, id int) (*graphql1.Risk, error) {
	risk, err := r.uc.Risk.GetRisk(ctx, int64(id))
	if err != nil {
		return nil, err
	}

	return toGraphQLRisk(risk), nil
}

// Mutation returns MutationResolver implementation.
func (r *Resolver) Mutation() MutationResolver { return &mutationResolver{r} }

// Query returns QueryResolver implementation.
func (r *Resolver) Query() QueryResolver { return &queryResolver{r} }

type mutationResolver struct{ *Resolver }
type queryResolver struct{ *Resolver }

// Helper functions

func toGraphQLRisk(risk *model.Risk) *graphql1.Risk {
	return &graphql1.Risk{
		ID:          int(risk.ID),
		Name:        risk.Name,
		Description: risk.Description,
		CreatedAt:   risk.CreatedAt,
		UpdatedAt:   risk.UpdatedAt,
	}
}
